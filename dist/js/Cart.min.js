class Cart{constructor(t,a="#cart"){this.source=t,this.container=a,this.countGoods=0,this.amount=0,this.notavalCount=0,this.notavalSum=0,this.cartItems=[],this._init(),this._recount(),this._removePos()}_render(){let t=$("<div/>",{class:"cart-items-wrap"}),a=$("<div/>",{class:"cart-summary sum-count"}),e=$("<div/>",{class:"cart-summary sum-price"});$(this.container).text("Корзина"),t.appendTo($(this.container)),a.appendTo($(this.container)),e.appendTo($(this.container))}_init(){this._render(),fetch(this.source).then(t=>t.json()).then(t=>{for(let a of t.contents)this.cartItems.push(a),this._renderProduct(a);this.amount=t.amount,this.countGoods=t.countGoods,this._renderSum()})}_renderProduct(t){let a=$("<div/>",{class:"cart-item","data-product":t.id_product});a.append($(`<p class="product-name">${t.product_name}</p>`)),$("#products").find(`[data-id="${t.id_product}"]`).length?(a.addClass("aval"),a.append($(`<p class="product-quantity">${t.quantity}</p>`)),a.append($(`<p class="product-price">${t.price} руб.</p>`)),a.append($('<button class="count add-one">+</button>')),1===t.quantity?a.append($('<button class="count delete-one" disabled>-</button>')):a.append($('<button class="count delete-one">-</button>'))):(a.append($('<strong class="nalabel">Нет в наличии</strong>')),a.addClass("notaval"),this.notavalCount+=t.quantity,this.notavalSum+=t.quantity*t.price),a.append($('<button class="removepos">Удалить</button>')),a.appendTo($(".cart-items-wrap"))}_renderSum(){$(".sum-count").text(`Всего товаров в корзине: ${this.countGoods-this.notavalCount}`),$(".sum-price").text(`Общая стоимость: ${this.amount-this.notavalSum}`)}_updateCart(t){let a=$(`div[data-product="${t.id_product}"]`);a.find(".product-quantity").text(t.quantity),a.find(".product-price").text(`${t.quantity*t.price} руб.`),1===t.quantity?a.find(".delete-one").prop("disabled",!0):a.find(".delete-one").prop("disabled",!1)}addProduct(t){let a=+$(t).data("id"),e=this.cartItems.find(t=>t.id_product===a);if(e)e.quantity++,this.countGoods++,this.amount+=e.price,this._updateCart(e);else{let e={id_product:a,price:+$(t).data("price"),product_name:$(t).data("title"),quantity:1};this.cartItems.push(e),this.amount+=e.price,this.countGoods+=e.quantity,this._renderProduct(e)}this._recountCart()}_recount(){$("#cart").on("click",".count",t=>{let a=+$(t.target).parents(".cart-item").data("product");for(let e of this.cartItems)e.id_product===a&&($(t.target).hasClass("add-one")&&(e.quantity++,this.countGoods++,this.amount+=e.price),$(t.target).hasClass("delete-one")&&(e.quantity--,this.countGoods--,this.amount-=e.price),this._updateCart(e)),this._recountCart()})}_removePos(){$("#cart").on("click",".removepos",t=>{let a=+$(t.target).parents(".cart-item").data("product");for(let t of this.cartItems)t.id_product===a&&(this.countGoods-=t.quantity,this.amount-=t.price*t.quantity,this.cartItems=this.cartItems.filter(t=>t.id_product!==a),$(`.cart-item[data-product="${t.id_product}"]`).remove()),this._updateCart(t),this._recountCart()})}_recountCart(){if($(".cart-item.aval").length){let t=$(".cart-item.aval"),a=0,e=0;for(let o of t){let t=parseInt($(o).find(".product-price").text()),s=+$(o).find(".product-quantity").text();a+=t,e+=s}this.countGoods=e,this.amount=a}else this.countGoods=0,this.amount=0;$(".sum-count").text(`Всего товаров в корзине: ${this.countGoods}`),$(".sum-price").text(`Общая стоимость: ${this.amount}`)}}